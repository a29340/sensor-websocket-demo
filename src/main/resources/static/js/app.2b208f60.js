(function(t){function e(e){for(var o,a,r=e[0],c=e[1],l=e[2],d=0,f=[];d<r.length;d++)a=r[d],Object.prototype.hasOwnProperty.call(i,a)&&i[a]&&f.push(i[a][0]),i[a]=0;for(o in c)Object.prototype.hasOwnProperty.call(c,o)&&(t[o]=c[o]);u&&u(e);while(f.length)f.shift()();return s.push.apply(s,l||[]),n()}function n(){for(var t,e=0;e<s.length;e++){for(var n=s[e],o=!0,r=1;r<n.length;r++){var c=n[r];0!==i[c]&&(o=!1)}o&&(s.splice(e--,1),t=a(a.s=n[0]))}return t}var o={},i={app:0},s=[];function a(e){if(o[e])return o[e].exports;var n=o[e]={i:e,l:!1,exports:{}};return t[e].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=t,a.c=o,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},a.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)a.d(n,o,function(e){return t[e]}.bind(null,o));return n},a.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/";var r=window["webpackJsonp"]=window["webpackJsonp"]||[],c=r.push.bind(r);r.push=e,r=r.slice();for(var l=0;l<r.length;l++)e(r[l]);var u=c;s.push([0,"chunk-vendors"]),n()})({0:function(t,e,n){t.exports=n("56d7")},"034f":function(t,e,n){"use strict";n("85ec")},"0612":function(t,e,n){},"56d7":function(t,e,n){"use strict";n.r(e);n("e260"),n("e6cf"),n("cca6"),n("a79d");var o=n("2b0e"),i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{attrs:{id:"app"}},[t.showRoom?t._e():n("section",{staticClass:"section"},[n("div",{staticClass:"container box"},[n("h1",{staticClass:"title"},[t._v("Room settings")]),n("h2",{staticClass:"subtitle"},[t._v("Create or enter a room.")]),n("b-field",{attrs:{label:"Room name","label-position":"on-border"}},[n("b-input",{model:{value:t.room,callback:function(e){t.room=e},expression:"room"}}),n("p",{staticClass:"control"},[n("b-button",{attrs:{type:"is-primary is-light"},on:{click:function(e){return t.createRoom()}}},[t._v("Create")])],1)],1),n("b-field",{attrs:{label:"Client","label-position":"on-border"}},[n("b-input",{model:{value:t.clientId,callback:function(e){t.clientId=e},expression:"clientId"}}),n("p",{staticClass:"control"},[n("b-button",{attrs:{type:"is-primary is-light"},on:{click:function(e){return t.enterRoom()}}},[t._v("Enter")])],1)],1)],1)]),t.showRoom?n("section",{staticClass:"section"},[n("RoomComponent",{attrs:{"room-name":t.room,"client-id":t.clientId},on:{leave:function(e){return t.leaveRoom()}}})],1):t._e()])},s=[],a=(n("e9c4"),n("d3b7"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"container box"},[n("h1",{staticClass:"title"},[t._v(t._s(t.roomName))]),n("h2",{staticClass:"subtitle"},[t._v("Display the room's clients and their state.")]),n("h2",{staticClass:"subtitle"},[t._v("You are the client "+t._s(t.clientId))]),n("div",{staticClass:"is-flex is-flex-direction-column is-justify-content-center"},[n("div",{staticClass:"is-flex is-flex-wrap-wrap"},t._l(t.clients,(function(t){return n("client-component",{key:t.id,attrs:{client:t}})})),1),n("b-button",{staticClass:"m-3",attrs:{type:"is-primary is-light"},on:{click:function(e){return t.leaveRoom()}}},[t._v("Leave Room")])],1)])}),r=[],c=(n("b0c0"),function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"card m-3"},[n("header",{staticClass:"card-header has-background-primary"},[n("p",{staticClass:"card-header-title has-text-primary-light"},[t._v(t._s(t.client.id))])]),n("div",{staticClass:"card-content has-background-primary-light\t"},[n("div",{staticClass:"content"},[n("div",{staticClass:"is-flex is-justify-content-space-between"},[n("div",[t._v("α:")]),n("div",[t._v(t._s(t.client.alpha))])]),n("div",{staticClass:"is-flex is-justify-content-space-between"},[n("div",[t._v("β:")]),n("div",[t._v(t._s(t.client.beta))])]),n("div",{staticClass:"is-flex is-justify-content-space-between"},[n("div",[t._v("γ:")]),n("div",[t._v(t._s(t.client.gamma))])])])])])}),l=[],u={name:"ClientComponent",props:{client:{}}},d=u,f=(n("8209"),n("2877")),p=Object(f["a"])(d,c,l,!1,null,"2154530c",null),m=p.exports,h=n("d4ec"),b=n("bee2"),v=n("ade3"),y=n("cc7d"),g=n.n(y),_=n("c6e1"),C=n.n(_),$=function(){function t(){Object(h["a"])(this,t),Object(v["a"])(this,"client",void 0),Object(v["a"])(this,"socket",void 0),Object(v["a"])(this,"connected",!1)}return Object(b["a"])(t,[{key:"connect",value:function(t,e,n,o){var i=this;this.socket=new g.a("sensors"),this.client=C.a.over(this.socket),this.client.debug=function(){},this.client.connect({},(function(){i.connected=!0,e(),i.client.subscribe(t,(function(t){n(JSON.parse(t.body))}))}),(function(t){console.log(t),i.connected=!1,o()}))}},{key:"disconnect",value:function(t){this.client&&this.client.disconnect(),this.connected=!1,t()}},{key:"send",value:function(t){this.client&&this.client.connected&&this.client.send("/app/sensors",JSON.stringify(t))}}]),t}(),w=new $,R=n("8dfe"),O={name:"RoomComponent",props:{roomName:String,clientId:String},emits:["leave"],data:function(){return{clients:[],sensor:{}}},mounted:function(){var t=this,e=this;w.connect("/topic/room/"+this.$props.roomName,(function(){t.$buefy.notification.open({message:"Websocket connected to room ".concat(t.$props.roomName),type:"is-success is-light"});try{e.$data.sensor=new R["a"]({frequency:30}),e.$data.sensor.addEventListener("error",(function(t){"NotAllowedError"===t.error.name||"NotReadableError"===t.error.name&&e.notifyError("Cannot connect to the sensor.")})),e.$data.sensor.addEventListener("reading",(function(){w.send({id:e.$props.clientId,alpha:e.$data.sensor.y,beta:e.$data.sensor.x,gamma:e.$data.sensor.z})})),e.$data.sensor.start()}catch(n){if("SecurityError"===n.name)e.notifyError("Sensor construction was blocked by a feature policy.");else{if("ReferenceError"!==n.name)throw n;e.notifyError("Sensor is not supported by the User Agent.")}}}),(function(e){t.$data.clients=e.clients}),(function(e){t.notifyError("Websocket error: ".concat(e))}))},components:{ClientComponent:m},methods:{leaveRoom:function(){this.$data.sensor.stop&&this.$data.sensor.stop(),w.disconnect((function(){return console.log("disconnected websocket")})),this.$emit("leave")},notifyError:function(t){this.$buefy.notification.open({message:t,type:"is-danger is-light"})}}},j=O,x=Object(f["a"])(j,a,r,!1,null,"79e603b6",null),k=x.exports,S={name:"App",data:function(){return{room:"",clientId:"",showRoom:!1}},components:{RoomComponent:k},methods:{enterRoom:function(){var t=this,e="room/"+t.$data.room+"/enter",n=new Request(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t.$data.clientId,alpha:0,beta:0,gamma:0})});fetch(n).then((function(e){200===e.status?(t.$buefy.notification.open({message:"Room entered.",type:"is-success is-light"}),t.$data.showRoom=!0):(console.log(e),t.$buefy.notification.open({message:e.status,type:"is-danger is-light"}))}))},createRoom:function(){var t=this,e="room/"+this.$data.room;fetch(new Request(e),{method:"POST"}).then((function(e){200===e.status?t.$buefy.notification.open({message:"Room created.",type:"is-success"}):t.$buefy.notification.open({message:e.status,type:"is-danger"})}))},leaveRoom:function(){var t=this,e="room/"+t.$data.room+"/leave",n=new Request(e,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:t.$data.clientId,alpha:0,beta:0,gamma:0})});fetch(n).then((function(e){200===e.status?(t.$buefy.notification.open({message:"Room leaved.",type:"is-success is-light"}),t.$data.showRoom=!1):(console.log(e),t.$buefy.notification.open({message:e.status,type:"is-danger is-light"}))}))}}},E=S,I=(n("034f"),Object(f["a"])(E,i,s,!1,null,null,null)),N=I.exports,P=n("289d");n("5abe");o["a"].use(P["a"]),o["a"].config.productionTip=!1,new o["a"]({render:function(t){return t(N)}}).$mount("#app")},8209:function(t,e,n){"use strict";n("0612")},"85ec":function(t,e,n){}});
//# sourceMappingURL=app.2b208f60.js.map